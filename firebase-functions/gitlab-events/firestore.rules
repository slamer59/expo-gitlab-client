rules_version = '2';

service cloud.firestore {
  match /databases/{database}/documents {
    // User notifications collection
    // Each document is keyed by the Expo push token
    match /userNotifications/{expoToken} {
      // Allow access only if the document ID matches a valid Expo token format
      // Expo tokens can be either:
      // 1. ExponentPushToken[...] format
      // 2. 22-character alphanumeric string with dashes/underscores
      allow read, write: if expoToken.matches('^ExponentPushToken\\[.+\\]$') ||
                           expoToken.matches('^[a-zA-Z0-9_-]{22}$');
    }

    // Deny all other access by default
    match /{document=**} {
      allow read, write: if false;
    }
  }
}